{% extends 'dashboard_layout.html' %}
{% block dashboard_content %}
<div class="p-8 pt-20 max-w-3xl mx-auto">
  <h1 class="text-3xl font-bold mb-6">Competitor Watch</h1>
  <p class="text-lg text-gray-600 mb-8">Track your competitors' latest content and get AI-powered improvement briefs to outperform them.</p>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8">
    <h2 class="text-xl font-semibold mb-4">Add Competitor Blog</h2>
    <form method="POST" class="flex gap-2 mb-4">
      <input type="url" name="blog_url" placeholder="Enter competitor blog URL" class="px-4 py-2 rounded bg-gray-900 text-white w-full" required>
      <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded font-bold hover:bg-blue-700">Add</button>
    </form>
    <ul>
      {% for competitor in competitors %}
      <li class="mb-2 flex justify-between items-center">
        <span class="text-gray-800 dark:text-gray-200">{{ competitor.url }}</span>
        <form method="POST" style="display:inline;">
          <input type="hidden" name="remove_id" value="{{ competitor.id }}">
          <button type="submit" class="px-2 py-1 bg-red-600 text-white rounded text-xs">Remove</button>
        </form>
      </li>
      {% else %}
      <li class="text-gray-500 py-2">No competitors added yet.</li>
      {% endfor %}
    </ul>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold mb-4">Latest Competitor Articles</h2>
    <ul>
      {% for article in articles %}
      <li class="mb-4">
        <div class="flex flex-col md:flex-row md:items-center justify-between">
          <div>
            <a href="{{ article.url }}" target="_blank" class="font-bold text-blue-600 hover:underline">{{ article.title }}</a>
            <div class="text-xs text-gray-500">{{ article.published_at }}</div>
          </div>
          <form method="POST" class="mt-2 md:mt-0">
            <input type="hidden" name="improve_id" value="{{ article.id }}">
            <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded font-semibold text-sm hover:bg-green-700">View Improvement Brief</button>
          </form>
        </div>
        {% if article.improvement_brief %}
        <div class="mt-2 p-4 bg-gray-100 dark:bg-gray-900 rounded">
          <h3 class="font-semibold mb-1">AI Improvement Brief:</h3>
          <div class="text-xs text-gray-700 dark:text-gray-300">{{ article.improvement_brief }}</div>
        </div>
        {% endif %}
      </li>
      {% else %}
      <li class="text-gray-500 py-2">No competitor articles found yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
